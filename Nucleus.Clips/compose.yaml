services:
  nucleus-clips:
    build:
      context: ..
      dockerfile: Nucleus.Clips/Dockerfile
    container_name: nucleus-clips
    restart: unless-stopped
    expose:
      - "8080"
    environment:
      # Core ASP.NET
      ASPNETCORE_ENVIRONMENT: ${ASPNETCORE_ENVIRONMENT}
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: ${ASPNETCORE_FORWARDEDHEADERS_ENABLED}
      ASPNETCORE_URLS: ${ASPNETCORE_URLS}
      # Database
      DatabaseConnectionString: ${DatabaseConnectionString}
      RedisConnectionString: ${RedisConnectionString:-}
      # Discord
      DiscordClientId: ${DiscordClientId}
      DiscordClientSecret: ${DiscordClientSecret}
      # Bunny CDN
      BunnyLibraryId: ${BunnyLibraryId:-}
      BunnyAccessKey: ${BunnyAccessKey:-}
      # Apex Legends
      ApexLegendsApiKey: ${ApexLegendsApiKey:-}
      # IGDB
      IgdbClientId: ${IgdbClientId}
      IgdbClientSecret: ${IgdbClientSecret}
      # FFmpeg
      FFmpegOutputPath: ${FFmpegSharedPath:-/tmp/ffmpeg-downloads}
    networks:
      - dokploy-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  dokploy-network:
    external: true
